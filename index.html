<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Mockup Prompt Generator</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #fafafa;
            color: #1a1a1a;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 48px 24px;
        }

        header {
            margin-bottom: 48px;
        }

        h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .subtitle {
            color: #666;
            font-size: 15px;
        }

        .task-badge {
            display: inline-block;
            background: #1a1a1a;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            margin-bottom: 16px;
        }

        .instructions {
            background: #f0f0f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 32px;
        }

        .instructions h3 {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #333;
        }

        .instructions ol {
            padding-left: 20px;
            font-size: 14px;
            color: #555;
        }

        .instructions li {
            margin-bottom: 8px;
        }

        .input-section {
            margin-bottom: 40px;
        }

        .input-group {
            margin-bottom: 24px;
        }

        label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .label-hint {
            font-weight: 400;
            color: #888;
            margin-left: 8px;
        }

        input[type="text"], textarea, select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e5e5e5;
            border-radius: 10px;
            font-size: 15px;
            font-family: inherit;
            transition: border-color 0.2s, box-shadow 0.2s;
            background: white;
        }

        select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 18px;
            padding-right: 44px;
        }

        input[type="text"]:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #1a1a1a;
            box-shadow: 0 0 0 3px rgba(26, 26, 26, 0.1);
        }

        input[type="text"]::placeholder, textarea::placeholder {
            color: #aaa;
        }

        .image-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .image-card {
            background: white;
            border: 2px solid #e5e5e5;
            border-radius: 12px;
            overflow: hidden;
        }

        .image-card.full-width {
            grid-column: 1 / -1;
        }

        .image-card-header {
            padding: 12px 16px;
            background: #fafafa;
            border-bottom: 1px solid #e5e5e5;
        }

        .image-card-header h4 {
            font-size: 13px;
            font-weight: 600;
            color: #333;
        }

        .image-card-header span {
            font-size: 12px;
            color: #888;
            font-weight: 400;
        }

        .image-preview {
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            background: #f8f8f8;
        }

        .image-preview img {
            max-width: 100%;
            max-height: 250px;
            object-fit: contain;
            border-radius: 8px;
        }

        .output-section {
            background: white;
            border: 2px solid #e5e5e5;
            border-radius: 12px;
            overflow: hidden;
        }

        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid #e5e5e5;
            background: #fafafa;
        }

        .output-header h2 {
            font-size: 14px;
            font-weight: 600;
        }

        .copy-btn, .btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            background: #1a1a1a;
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
        }

        .copy-btn:hover, .btn:hover {
            background: #333;
        }

        .copy-btn:active, .btn:active {
            transform: scale(0.98);
        }

        .copy-btn.copied {
            background: #22c55e;
        }

        .copy-btn svg, .btn svg {
            width: 16px;
            height: 16px;
        }

        .btn-secondary {
            background: white;
            color: #1a1a1a;
            border: 2px solid #e5e5e5;
        }

        .btn-secondary:hover {
            background: #f5f5f5;
        }

        .btn-danger {
            background: #ef4444;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .output-content {
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        #promptOutput {
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-size: 12px;
            line-height: 1.7;
            white-space: pre-wrap;
            color: #333;
        }

        footer {
            margin-top: 48px;
            padding-top: 24px;
            border-top: 1px solid #e5e5e5;
            text-align: center;
            color: #888;
            font-size: 13px;
        }

        .input-with-hint {
            position: relative;
        }

        .explainer-hint {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            padding: 10px 14px;
            background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%);
            border-radius: 8px;
            border-left: 3px solid #a855f7;
        }

        .hand-pointer {
            font-size: 20px;
            animation: point 1s ease-in-out infinite;
        }

        @keyframes point {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }

        .hint-text {
            font-size: 13px;
            color: #6b21a8;
            font-weight: 500;
        }

        .readonly-input {
            background: #f5f5f5 !important;
            color: #666 !important;
            cursor: not-allowed;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 32px;
            border-bottom: 2px solid #e5e5e5;
            padding-bottom: 0;
        }

        .tab {
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            background: none;
            border: none;
            cursor: pointer;
            position: relative;
            transition: color 0.2s;
        }

        .tab:hover {
            color: #333;
        }

        .tab.active {
            color: #1a1a1a;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #1a1a1a;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Design Gallery */
        .gallery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .gallery-header h2 {
            font-size: 18px;
            font-weight: 600;
        }

        .gallery-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }

        .sync-status {
            font-size: 12px;
            color: #888;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .sync-status.syncing {
            color: #a855f7;
        }

        .sync-status.error {
            color: #ef4444;
        }

        /* Upload Form */
        .upload-form {
            background: white;
            border: 2px solid #e5e5e5;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .upload-form h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-group label {
            font-size: 12px;
            font-weight: 600;
            color: #555;
            margin-bottom: 0;
        }

        .form-group select, .form-group input {
            padding: 10px 12px;
            font-size: 14px;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            background: #f5f5f5;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .checkbox-label:hover {
            border-color: #ccc;
        }

        .checkbox-label.checked {
            background: #f3e8ff;
            border-color: #a855f7;
            color: #6b21a8;
        }

        .checkbox-label input {
            display: none;
        }

        .color-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 2px solid rgba(0,0,0,0.1);
        }

        .color-dot.blue { background: #3b82f6; }
        .color-dot.pink { background: #ec4899; }
        .color-dot.purple { background: #8b5cf6; }
        .color-dot.grey { background: #6b7280; }

        .upload-zone {
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: #fafafa;
            margin-top: 16px;
        }

        .upload-zone:hover {
            border-color: #a855f7;
            background: #faf5ff;
        }

        .upload-zone.dragover {
            border-color: #a855f7;
            background: #f3e8ff;
        }

        .upload-zone.uploading {
            pointer-events: none;
            opacity: 0.7;
        }

        .upload-zone-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .upload-zone-text {
            font-size: 15px;
            color: #666;
            margin-bottom: 4px;
        }

        .upload-zone-hint {
            font-size: 13px;
            color: #999;
        }

        /* Filters */
        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 20px;
            padding: 16px;
            background: #f5f5f5;
            border-radius: 10px;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-group label {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            margin-bottom: 0;
        }

        .filter-group select {
            padding: 8px 32px 8px 12px;
            font-size: 13px;
            border-radius: 8px;
        }

        .design-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 16px;
        }

        .design-item {
            background: white;
            border: 2px solid #e5e5e5;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.2s;
            cursor: pointer;
        }

        .design-item:hover {
            border-color: #a855f7;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .design-item-image {
            aspect-ratio: 1;
            background: #f8f8f8;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .design-item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .design-item-info {
            padding: 12px;
        }

        .design-item-name {
            font-size: 13px;
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .design-item-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .tag {
            font-size: 10px;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 500;
        }

        .tag-category {
            background: #dbeafe;
            color: #1d4ed8;
        }

        .tag-designer {
            background: #fce7f3;
            color: #be185d;
        }

        .tag-notebook {
            background: #f3f4f6;
            color: #374151;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .tag-notebook .color-dot {
            width: 8px;
            height: 8px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 15px;
            margin-bottom: 8px;
        }

        .empty-state-hint {
            font-size: 13px;
            color: #aaa;
        }

        .loading-state {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #e5e5e5;
            border-top-color: #a855f7;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 16px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e5e5e5;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 16px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #888;
            line-height: 1;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-preview {
            width: 100%;
            aspect-ratio: 1;
            background: #f8f8f8;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 16px;
            overflow: hidden;
        }

        .modal-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .modal-info {
            margin-bottom: 16px;
        }

        .modal-info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
        }

        .modal-info-label {
            color: #888;
        }

        .modal-info-value {
            font-weight: 500;
        }

        .modal-actions {
            display: flex;
            gap: 8px;
        }

        .modal-actions button {
            flex: 1;
        }

        @media (max-width: 600px) {
            .container {
                padding: 24px 16px;
            }

            h1 {
                font-size: 24px;
            }

            .image-grid {
                grid-template-columns: 1fr;
            }

            .output-header {
                flex-direction: column;
                gap: 12px;
                align-items: stretch;
            }

            .tabs {
                overflow-x: auto;
            }

            .gallery-header {
                flex-direction: column;
                align-items: stretch;
            }

            .gallery-actions {
                justify-content: stretch;
            }

            .gallery-actions button {
                flex: 1;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .filters {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Embossed Notebook Design Generator</h1>
            <p class="subtitle">Generate prompts for creating embossed notebook designs in ChatGPT</p>
        </header>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('inspiration')">Inspiration Library</button>
            <button class="tab" onclick="switchTab('designs')">Design Library</button>
            <button class="tab" onclick="switchTab('generator')">1. Design to Product Image Mockup</button>
        </div>

        <!-- Generator Tab -->
        <div id="generator-tab" class="tab-content">
            <div class="instructions">
                <h3>How to use</h3>
                <ol>
                    <li>Select a base notebook color from the dropdown</li>
                    <li>Describe your design artwork (Image B)</li>
                    <li>Upload the 3 images shown below into ChatGPT</li>
                    <li>Copy the generated prompt and paste it into ChatGPT</li>
                </ol>
            </div>

            <div class="input-section">
                <div class="input-group">
                    <label>
                        Image A ‚Äî Base Notebook Color
                    </label>
                    <select id="notebookColor" onchange="updateImages()">
                        <option value="blue">Blue</option>
                        <option value="grey">Grey</option>
                        <option value="pink">Pink</option>
                        <option value="purple">Purple</option>
                    </select>
                </div>

                <div class="input-group image-b-group">
                    <label>
                        Image B ‚Äî Design Description
                    </label>
                    <div class="input-with-hint">
                        <input
                            type="text"
                            id="imageB"
                            placeholder="e.g., watercolour art, geometric pattern, floral illustration"
                            value="watercolour art"
                        >
                        <div class="explainer-hint">
                            <span class="hand-pointer">üëÜ</span>
                            <span class="hint-text">Describe the design you're uploading to mockup</span>
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label>
                        Image C ‚Äî Embossing Reference
                        <span class="label-hint">(fixed)</span>
                    </label>
                    <input
                        type="text"
                        id="imageC"
                        value="A blue PU notebook with an embossed dog design"
                        readonly
                        class="readonly-input"
                    >
                </div>
            </div>

            <h3 style="font-size: 14px; margin-bottom: 16px; color: #333;">Images to upload to ChatGPT <span style="font-weight: 400; color: #999;">(you can copy & paste directly)</span></h3>

            <div class="image-grid">
                <div class="image-card">
                    <div class="image-card-header">
                        <h4>Image A ‚Äî Base Notebook</h4>
                        <span id="imageALabel">blue.png</span>
                    </div>
                    <div class="image-preview">
                        <img id="imageAPreview" src="Template Images for Product Listing/blue.png" alt="Base notebook">
                    </div>
                </div>

                <div class="image-card">
                    <div class="image-card-header">
                        <h4>Image C ‚Äî Embossing Reference</h4>
                        <span>bluedog.png</span>
                    </div>
                    <div class="image-preview">
                        <img src="Template Images for Product Listing/bluedog.png" alt="Embossing reference">
                    </div>
                </div>

                <div class="image-card full-width">
                    <div class="image-card-header">
                        <h4>Image B ‚Äî Your Design</h4>
                        <span>Upload your own artwork or select from Design Library</span>
                    </div>
                    <div class="image-preview" id="imageBPreview" style="min-height: 100px; color: #888; font-size: 14px;">
                        <span id="imageBPlaceholder">Upload your design artwork to ChatGPT</span>
                        <img id="imageBSelected" style="display: none;" alt="Selected design">
                    </div>
                </div>
            </div>

            <div class="output-section">
                <div class="output-header">
                    <h2>Generated Prompt</h2>
                    <button class="copy-btn" onclick="copyPrompt()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                        </svg>
                        <span id="copyText">Copy Prompt</span>
                    </button>
                </div>
                <div class="output-content">
                    <div id="promptOutput"></div>
                </div>
            </div>
        </div>

        <!-- Design Library Tab -->
        <div id="designs-tab" class="tab-content">
            <div class="gallery-header">
                <h2>Design Library</h2>
                <div class="gallery-actions">
                    <span id="syncStatus" class="sync-status">
                        <span>‚òÅÔ∏è</span> Synced
                    </span>
                    <button class="btn btn-secondary btn-sm" onclick="loadDesigns()">
                        Refresh
                    </button>
                </div>
            </div>

            <!-- Upload Form -->
            <div class="upload-form">
                <h3>Upload New Design</h3>

                <div class="form-row">
                    <div class="form-group">
                        <label>Category</label>
                        <select id="uploadCategory">
                            <option value="Animal">Animal</option>
                            <option value="Floral">Floral</option>
                            <option value="Pastel">Pastel</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Designer</label>
                        <select id="uploadDesigner">
                            <option value="Helen">Helen</option>
                            <option value="David">David</option>
                            <option value="Feb">Feb</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Base Notebook Suggestions (select at least one)</label>
                    <div class="checkbox-group" id="notebookCheckboxes">
                        <label class="checkbox-label" onclick="toggleCheckbox(this)">
                            <input type="checkbox" value="blue">
                            <span class="color-dot blue"></span>
                            Blue
                        </label>
                        <label class="checkbox-label" onclick="toggleCheckbox(this)">
                            <input type="checkbox" value="pink">
                            <span class="color-dot pink"></span>
                            Pink
                        </label>
                        <label class="checkbox-label" onclick="toggleCheckbox(this)">
                            <input type="checkbox" value="purple">
                            <span class="color-dot purple"></span>
                            Purple
                        </label>
                        <label class="checkbox-label" onclick="toggleCheckbox(this)">
                            <input type="checkbox" value="grey">
                            <span class="color-dot grey"></span>
                            Grey
                        </label>
                    </div>
                </div>

                <div class="upload-zone" id="uploadZone" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-zone-icon">üìÅ</div>
                    <div class="upload-zone-text" id="uploadText">Drop your design images here or click to upload</div>
                    <div class="upload-zone-hint">Supports PNG, JPG, WEBP</div>
                    <input type="file" id="fileInput" accept="image/*" multiple style="display: none;" onchange="handleFileUpload(event)">
                </div>
            </div>

            <!-- Filters -->
            <div class="filters">
                <div class="filter-group">
                    <label>Category:</label>
                    <select id="filterCategory" onchange="loadDesigns()">
                        <option value="">All</option>
                        <option value="Animal">Animal</option>
                        <option value="Floral">Floral</option>
                        <option value="Pastel">Pastel</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Designer:</label>
                    <select id="filterDesigner" onchange="loadDesigns()">
                        <option value="">All</option>
                        <option value="Helen">Helen</option>
                        <option value="David">David</option>
                        <option value="Feb">Feb</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Notebook:</label>
                    <select id="filterNotebook" onchange="loadDesigns()">
                        <option value="">All</option>
                        <option value="blue">Blue</option>
                        <option value="pink">Pink</option>
                        <option value="purple">Purple</option>
                        <option value="grey">Grey</option>
                    </select>
                </div>
            </div>

            <div id="loadingState" class="loading-state" style="display: none;">
                <div class="loading-spinner"></div>
                <div>Loading designs...</div>
            </div>

            <div id="designGrid" class="design-grid">
                <!-- Designs will be populated here -->
            </div>

            <div id="emptyState" class="empty-state" style="display: none;">
                <div class="empty-state-icon">üé®</div>
                <div class="empty-state-text">No designs found</div>
                <div class="empty-state-hint">Upload your first design or adjust filters</div>
            </div>
        </div>

        <!-- Inspiration Library Tab -->
        <div id="inspiration-tab" class="tab-content active">
            <div class="gallery-header">
                <h2>Inspiration Library</h2>
                <div class="gallery-actions">
                    <span id="inspirationSyncStatus" class="sync-status">
                        <span>‚òÅÔ∏è</span> Synced
                    </span>
                    <button class="btn btn-secondary btn-sm" onclick="loadInspirations()">
                        Refresh
                    </button>
                </div>
            </div>

            <!-- Paste Explainer -->
            <div class="explainer-box" style="background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%); border-radius: 12px; padding: 16px 20px; margin-bottom: 20px; border-left: 4px solid #a855f7;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 28px;">üìã</span>
                    <div>
                        <div style="font-weight: 600; color: #6b21a8; margin-bottom: 2px;">Quick Upload: Copy & Paste</div>
                        <div style="font-size: 13px; color: #7c3aed;">Copy any inspiration image, fill in the description below, then press <kbd style="background: white; padding: 2px 6px; border-radius: 4px; font-family: monospace; font-size: 12px; border: 1px solid #d8b4fe;">Ctrl+V</kbd> to instantly upload</div>
                    </div>
                </div>
            </div>

            <!-- Upload Form -->
            <div class="upload-form">
                <h3>Upload Inspiration Image</h3>

                <div class="form-row">
                    <div class="form-group">
                        <label>Category</label>
                        <select id="inspirationCategory">
                            <option value="Animal">Animal</option>
                            <option value="Floral">Floral</option>
                            <option value="Pastel">Pastel</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Designer</label>
                        <select id="inspirationDesigner">
                            <option value="Helen">Helen</option>
                            <option value="David">David</option>
                            <option value="Feb">Feb</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Description <span style="font-weight: 400; color: #999;">(This will be used in the generator)</span></label>
                    <input type="text" id="inspirationDescription" placeholder="e.g., watercolour floral pattern, geometric abstract art, cute animal illustration">
                </div>

                <div class="upload-zone" id="inspirationUploadZone" onclick="document.getElementById('inspirationFileInput').click()" tabindex="0">
                    <div class="upload-zone-icon">‚ú®</div>
                    <div class="upload-zone-text" id="inspirationUploadText">Drop, paste (Ctrl+V), or click to upload</div>
                    <div class="upload-zone-hint">Supports PNG, JPG, WEBP ‚Äî paste images directly!</div>
                    <input type="file" id="inspirationFileInput" accept="image/*" multiple style="display: none;" onchange="handleInspirationUpload(event)">
                </div>
            </div>

            <!-- Filters -->
            <div class="filters">
                <div class="filter-group">
                    <label>Category:</label>
                    <select id="filterInspirationCategory" onchange="loadInspirations()">
                        <option value="">All</option>
                        <option value="Animal">Animal</option>
                        <option value="Floral">Floral</option>
                        <option value="Pastel">Pastel</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Designer:</label>
                    <select id="filterInspirationDesigner" onchange="loadInspirations()">
                        <option value="">All</option>
                        <option value="Helen">Helen</option>
                        <option value="David">David</option>
                        <option value="Feb">Feb</option>
                    </select>
                </div>
            </div>

            <div id="inspirationLoadingState" class="loading-state" style="display: none;">
                <div class="loading-spinner"></div>
                <div>Loading inspirations...</div>
            </div>

            <div id="inspirationGrid" class="design-grid">
                <!-- Inspirations will be populated here -->
            </div>

            <div id="inspirationEmptyState" class="empty-state" style="display: none;">
                <div class="empty-state-icon">‚ú®</div>
                <div class="empty-state-text">No inspiration images yet</div>
                <div class="empty-state-hint">Upload images to use as design references</div>
            </div>
        </div>

        <footer>
            Product Mockup Prompt Generator
        </footer>
    </div>

    <!-- Design Preview Modal -->
    <div class="modal-overlay" id="previewModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalTitle">Design Preview</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-preview">
                    <img id="modalImage" src="" alt="Design preview">
                </div>
                <div class="modal-info" id="modalInfo">
                    <!-- Info rows populated dynamically -->
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" onclick="useDesign()">Use in Generator</button>
                    <button class="btn btn-danger" id="deleteBtn" onclick="deleteDesign()">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Inspiration Preview Modal -->
    <div class="modal-overlay" id="inspirationModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="inspirationModalTitle">Inspiration Preview</h3>
                <button class="modal-close" onclick="closeInspirationModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-preview">
                    <img id="inspirationModalImage" src="" alt="Inspiration preview">
                </div>
                <div class="modal-info" id="inspirationModalInfo">
                    <!-- Info rows populated dynamically -->
                </div>
                <div class="modal-actions">
                    <button class="btn" onclick="useInspiration()" style="background: linear-gradient(135deg, #a855f7 0%, #6366f1 100%);">
                        ‚ú® Use in Generator
                    </button>
                    <button class="btn btn-danger" id="deleteInspirationBtn" onclick="deleteInspiration()">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://jyosixwjbsahcctyakdi.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_S5JGtvltlC1Q314L50QR4A_zYvzDjCR';
        const BUCKET_NAME = 'designs';

        // Initialize Supabase client
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Design storage
        let designs = [];
        let currentDesign = null;

        // Inspiration storage
        let inspirations = [];
        let currentInspiration = null;

        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

            document.querySelector(`[onclick="switchTab('${tab}')"]`).classList.add('active');
            document.getElementById(`${tab}-tab`).classList.add('active');

            if (tab === 'designs') {
                loadDesigns();
            } else if (tab === 'inspiration') {
                loadInspirations();
            }
        }

        // Checkbox toggle
        function toggleCheckbox(label) {
            const checkbox = label.querySelector('input[type="checkbox"]');
            checkbox.checked = !checkbox.checked;
            label.classList.toggle('checked', checkbox.checked);
        }

        function getSelectedNotebooks() {
            const checkboxes = document.querySelectorAll('#notebookCheckboxes input[type="checkbox"]:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }

        // Color descriptions
        const colorDescriptions = {
            blue: 'A PLAIN blue PU-leather notebook',
            grey: 'A PLAIN grey PU-leather notebook',
            pink: 'A PLAIN pink PU-leather notebook',
            purple: 'A PLAIN purple PU-leather notebook'
        };

        function updateImages() {
            const color = document.getElementById('notebookColor').value;
            document.getElementById('imageAPreview').src = `Template Images for Product Listing/${color}.png`;
            document.getElementById('imageALabel').textContent = `${color}.png`;
            generatePrompt();
        }

        function generatePrompt() {
            const color = document.getElementById('notebookColor').value;
            const imageA = colorDescriptions[color];
            const imageB = document.getElementById('imageB').value || '[Describe Image B]';
            const imageC = 'A blue PU notebook with an embossed dog design';

            const prompt = `Create the image using the instructions below. Do not use python.

IMAGE A ‚Äî BASE NOTEBOOK (EDIT THIS IMAGE)
Describe Image A in one sentence:
${imageA}

IMAGE B ‚Äî DESIGN SOURCE (ARTWORK ONLY)
Describe Image B in one sentence:
${imageB}

IMAGE C ‚Äî EMBOSSING & LIGHTING REFERENCE (REFERENCE ONLY)
Describe Image C in one sentence:
${imageC}

HOW EACH IMAGE MAY BE USED

IMAGE A (Base Notebook)
This image defines and must retain:
‚Ä¢ notebook shape, size, thickness, proportions
‚Ä¢ camera angle, perspective, framing
‚Ä¢ lighting direction and shadows
‚Ä¢ background and props
‚Ä¢ surface material and texture (smooth PU leather)

‚ö†Ô∏è Image A must remain visually identical except for:
‚Ä¢ the design that gets translated onto the cover

IMAGE B (Design Source)
Use only:
‚Ä¢ the artwork
‚Ä¢ the colour palette for the notebook cover

‚ùå Do NOT copy from Image B:
‚Ä¢ lighting
‚Ä¢ texture
‚Ä¢ background
‚Ä¢ composition
‚Ä¢ notebook geometry or notebook size or notebook features or stitching or any other effects

IMAGE C (Reference Only)
Image C exists ONLY to teach:
‚Ä¢ how strong embossing should look in photography
‚Ä¢ how lighting reveals raised texture
‚Ä¢ how shadows and highlights prove depth

‚ùå NEVER copy from Image C:
‚Ä¢ any artwork or motif
‚Ä¢ any colours
‚Ä¢ any layout or composition
‚Ä¢ any props or objects

If any design cue from Image C appears in the output, the result is INVALID.

CORE TASK
Edit IMAGE A so that:
‚Ä¢ The notebook cover colour matches the colour from IMAGE B
‚Ä¢ The artwork from IMAGE B is applied to the notebook cover
‚Ä¢ The artwork appears as a REAL, MANUFACTURED, UV-EMBOSSED / TESSELLATED PRINT
‚Ä¢ The notebook surface remains smooth everywhere except the embossed design

This is a photorealistic image edit, not a new generation.

NON-NEGOTIABLE EMBOSSING RULES
‚Ä¢ This is NOT flat printing.
‚Ä¢ You MUST exaggerate embossing depth so it is clearly visible in photos
‚Ä¢ Embossing must read as ~4‚Äì6mm at normal viewing distance
‚Ä¢ Embossing must be obvious without zooming
‚Ä¢ If embossing is subtle, the result is WRONG

HEIGHT VARIATION IS REQUIRED
‚Ä¢ Primary edges / outer silhouette ‚Üí highest relief
‚Ä¢ Major internal forms ‚Üí medium relief
‚Ä¢ Minor details ‚Üí shallow relief
‚Ä¢ Background leather ‚Üí zero relief

The design must appear PRESSED INTO the leather via pressure and UV curing ‚Äî not painted or stuck on top.

EDGE & SHADOW BEHAVIOUR (PROOF OF EMBOSS)
To prove embossing, you MUST show:
‚Ä¢ Clear contact shadows where raised ink meets flat leather
‚Ä¢ Shadow falloff on the down-light side of raised edges
‚Ä¢ Bright highlight bands on the light-facing edges
‚Ä¢ Micro self-shadowing between overlapping raised forms
‚Ä¢ Soft, rounded, organically pressed edges (no sharp cutouts)

If there are no visible shadows hugging the artwork edges, embossing is not convincing.

LEATHER INTERACTION (REALISM)
‚Ä¢ PU leather grain must continue seamlessly through embossed areas
‚Ä¢ Grain compresses slightly near raised edges
‚Ä¢ Base leather stays smooth everywhere except the design

‚ùå No stickers
‚ùå No decals
‚ùå No floating layers
‚ùå No white outlines

LIGHTING (DO NOT IGNORE)
Use strong raking light similar to Image C:
‚Ä¢ Catch raised edges with specular highlights
‚Ä¢ Cast visible micro-shadows across the surface
‚Ä¢ Increase local contrast around embossed regions
‚Ä¢ Make depth obvious even at thumbnail size

Flat lighting = failure.

POSITION & GEOMETRY (LOCKED)
‚Ä¢ Keep notebook geometry, camera angle, perspective, and placement identical to Image A
‚Ä¢ Do NOT change notebook thickness, edges, spine, ribbons, or page block
‚Ä¢ Apply the design in a natural, premium placement on the cover
‚Ä¢ Do NOT move, rotate, or resize the design arbitrarily

RENDERING CONSTRAINTS
‚Ä¢ Photorealistic product photography (not illustration)
‚Ä¢ No painterly textures
‚Ä¢ No canvas or paper grain
‚Ä¢ No CAD bevels or uniform extrusion

FINAL SELF-VALIDATION (MANDATORY)
Before outputting, ask yourself:
‚Ä¢ Does the notebook still look exactly like Image A?
‚Ä¢ Is the artwork ONLY from Image B?
‚Ä¢ Does the embossing read clearly at normal viewing distance?
‚Ä¢ Would a customer believe they could feel this with their fingertips?

If any answer is "no", fix it before outputting.
If not, increase embossing depth, edge highlights, and contact shadows until it passes.

Ensure the output is a high quality 4k resolution image with absolutely no fuzziness or grain.`;

            document.getElementById('promptOutput').textContent = prompt;
        }

        function copyPrompt() {
            const promptText = document.getElementById('promptOutput').textContent;
            navigator.clipboard.writeText(promptText).then(() => {
                const btn = document.querySelector('.copy-btn');
                const copyText = document.getElementById('copyText');
                btn.classList.add('copied');
                copyText.textContent = 'Copied!';

                setTimeout(() => {
                    btn.classList.remove('copied');
                    copyText.textContent = 'Copy Prompt';
                }, 2000);
            });
        }

        // Supabase Design Library Functions
        function setSyncStatus(status, message) {
            const statusEl = document.getElementById('syncStatus');
            statusEl.className = 'sync-status ' + status;
            if (status === 'syncing') {
                statusEl.innerHTML = '<span>üîÑ</span> ' + message;
            } else if (status === 'error') {
                statusEl.innerHTML = '<span>‚ö†Ô∏è</span> ' + message;
            } else {
                statusEl.innerHTML = '<span>‚òÅÔ∏è</span> ' + message;
            }
        }

        async function loadDesigns() {
            const grid = document.getElementById('designGrid');
            const emptyState = document.getElementById('emptyState');
            const loadingState = document.getElementById('loadingState');

            loadingState.style.display = 'block';
            grid.style.display = 'none';
            emptyState.style.display = 'none';
            setSyncStatus('syncing', 'Loading...');

            try {
                // Build query with filters
                let query = supabaseClient
                    .from('designs')
                    .select('*')
                    .order('created_at', { ascending: false });

                const filterCategory = document.getElementById('filterCategory').value;
                const filterDesigner = document.getElementById('filterDesigner').value;
                const filterNotebook = document.getElementById('filterNotebook').value;

                if (filterCategory) {
                    query = query.eq('category', filterCategory);
                }
                if (filterDesigner) {
                    query = query.eq('designer', filterDesigner);
                }
                if (filterNotebook) {
                    query = query.contains('base_notebooks', [filterNotebook]);
                }

                const { data, error } = await query;

                if (error) throw error;

                designs = data || [];
                renderDesigns();
                setSyncStatus('', 'Synced');
            } catch (error) {
                console.error('Error loading designs:', error);
                setSyncStatus('error', 'Failed to load');
            } finally {
                loadingState.style.display = 'none';
            }
        }

        function renderDesigns() {
            const grid = document.getElementById('designGrid');
            const emptyState = document.getElementById('emptyState');

            if (designs.length === 0) {
                grid.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            grid.style.display = 'grid';
            emptyState.style.display = 'none';

            grid.innerHTML = designs.map(design => `
                <div class="design-item" onclick="openPreview('${design.id}')">
                    <div class="design-item-image">
                        <img src="${design.file_url}" alt="${design.file_name}" loading="lazy">
                    </div>
                    <div class="design-item-info">
                        <div class="design-item-name">${design.file_name}</div>
                        <div class="design-item-tags">
                            <span class="tag tag-category">${design.category}</span>
                            <span class="tag tag-designer">${design.designer}</span>
                            ${design.base_notebooks.map(nb => `
                                <span class="tag tag-notebook">
                                    <span class="color-dot ${nb}"></span>
                                </span>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function handleFileUpload(event) {
            const files = event.target.files;
            if (!files.length) return;

            // Validate notebook selection
            const selectedNotebooks = getSelectedNotebooks();
            if (selectedNotebooks.length === 0) {
                alert('Please select at least one base notebook color');
                return;
            }

            const category = document.getElementById('uploadCategory').value;
            const designer = document.getElementById('uploadDesigner').value;

            const uploadZone = document.getElementById('uploadZone');
            const uploadText = document.getElementById('uploadText');

            uploadZone.classList.add('uploading');
            uploadText.textContent = 'Uploading...';
            setSyncStatus('syncing', 'Uploading...');

            try {
                for (const file of files) {
                    if (!file.type.startsWith('image/')) continue;

                    // Create unique filename
                    const timestamp = Date.now();
                    const safeName = file.name.replace(/[^a-zA-Z0-9.-]/g, '_');
                    const filePath = `${category}/${timestamp}_${safeName}`;

                    // Upload to storage
                    const { error: uploadError } = await supabaseClient.storage
                        .from(BUCKET_NAME)
                        .upload(filePath, file, {
                            cacheControl: '3600',
                            upsert: false
                        });

                    if (uploadError) throw uploadError;

                    // Get public URL
                    const fileUrl = `${SUPABASE_URL}/storage/v1/object/public/${BUCKET_NAME}/${filePath}`;

                    // Insert into database
                    const { error: dbError } = await supabaseClient
                        .from('designs')
                        .insert({
                            file_name: file.name,
                            file_url: fileUrl,
                            category: category,
                            designer: designer,
                            base_notebooks: selectedNotebooks
                        });

                    if (dbError) throw dbError;
                }

                await loadDesigns();
                setSyncStatus('', 'Synced');

                // Reset checkboxes
                document.querySelectorAll('#notebookCheckboxes .checkbox-label').forEach(label => {
                    label.classList.remove('checked');
                    label.querySelector('input').checked = false;
                });

            } catch (error) {
                console.error('Error uploading:', error);
                setSyncStatus('error', 'Upload failed');
                alert('Upload failed: ' + error.message);
            } finally {
                uploadZone.classList.remove('uploading');
                uploadText.textContent = 'Drop your design images here or click to upload';
                event.target.value = '';
            }
        }

        function openPreview(id) {
            currentDesign = designs.find(d => d.id === id);
            if (currentDesign) {
                document.getElementById('modalTitle').textContent = currentDesign.file_name;
                document.getElementById('modalImage').src = currentDesign.file_url;

                // Populate info
                document.getElementById('modalInfo').innerHTML = `
                    <div class="modal-info-row">
                        <span class="modal-info-label">Category</span>
                        <span class="modal-info-value">${currentDesign.category}</span>
                    </div>
                    <div class="modal-info-row">
                        <span class="modal-info-label">Designer</span>
                        <span class="modal-info-value">${currentDesign.designer}</span>
                    </div>
                    <div class="modal-info-row">
                        <span class="modal-info-label">Base Notebooks</span>
                        <span class="modal-info-value">${currentDesign.base_notebooks.map(n => n.charAt(0).toUpperCase() + n.slice(1)).join(', ')}</span>
                    </div>
                `;

                document.getElementById('previewModal').classList.add('active');
            }
        }

        function closeModal() {
            document.getElementById('previewModal').classList.remove('active');
            currentDesign = null;
        }

        function useDesign() {
            if (currentDesign) {
                document.getElementById('imageBPlaceholder').style.display = 'none';
                document.getElementById('imageBSelected').src = currentDesign.file_url;
                document.getElementById('imageBSelected').style.display = 'block';

                // Set notebook color to first suggested color
                if (currentDesign.base_notebooks.length > 0) {
                    document.getElementById('notebookColor').value = currentDesign.base_notebooks[0];
                    updateImages();
                }

                closeModal();
                switchTab('generator');
            }
        }

        async function deleteDesign() {
            if (!currentDesign) return;

            if (!confirm('Are you sure you want to delete this design?')) return;

            const deleteBtn = document.getElementById('deleteBtn');
            deleteBtn.disabled = true;
            deleteBtn.textContent = 'Deleting...';

            try {
                // Extract file path from URL
                const urlParts = currentDesign.file_url.split(`${BUCKET_NAME}/`);
                const filePath = urlParts[1];

                // Delete from storage
                const { error: storageError } = await supabaseClient.storage
                    .from(BUCKET_NAME)
                    .remove([filePath]);

                if (storageError) console.warn('Storage delete error:', storageError);

                // Delete from database
                const { error: dbError } = await supabaseClient
                    .from('designs')
                    .delete()
                    .eq('id', currentDesign.id);

                if (dbError) throw dbError;

                closeModal();
                await loadDesigns();
            } catch (error) {
                console.error('Error deleting:', error);
                alert('Delete failed: ' + error.message);
            } finally {
                deleteBtn.disabled = false;
                deleteBtn.textContent = 'Delete';
            }
        }

        // Drag and drop for designs
        const uploadZone = document.getElementById('uploadZone');

        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', () => {
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            const files = e.dataTransfer.files;
            handleFileUpload({ target: { files } });
        });

        // Close modal on overlay click
        document.getElementById('previewModal').addEventListener('click', (e) => {
            if (e.target.id === 'previewModal') {
                closeModal();
            }
        });

        // ===== INSPIRATION LIBRARY FUNCTIONS =====

        function setInspirationSyncStatus(status, message) {
            const statusEl = document.getElementById('inspirationSyncStatus');
            statusEl.className = 'sync-status ' + status;
            if (status === 'syncing') {
                statusEl.innerHTML = '<span>üîÑ</span> ' + message;
            } else if (status === 'error') {
                statusEl.innerHTML = '<span>‚ö†Ô∏è</span> ' + message;
            } else {
                statusEl.innerHTML = '<span>‚òÅÔ∏è</span> ' + message;
            }
        }

        async function loadInspirations() {
            const grid = document.getElementById('inspirationGrid');
            const emptyState = document.getElementById('inspirationEmptyState');
            const loadingState = document.getElementById('inspirationLoadingState');

            loadingState.style.display = 'block';
            grid.style.display = 'none';
            emptyState.style.display = 'none';
            setInspirationSyncStatus('syncing', 'Loading...');

            try {
                // Build query with filters
                let query = supabaseClient
                    .from('inspirations')
                    .select('*')
                    .order('created_at', { ascending: false });

                const filterCategory = document.getElementById('filterInspirationCategory').value;
                const filterDesigner = document.getElementById('filterInspirationDesigner').value;

                if (filterCategory) {
                    query = query.eq('category', filterCategory);
                }
                if (filterDesigner) {
                    query = query.eq('designer', filterDesigner);
                }

                const { data, error } = await query;

                if (error) throw error;

                inspirations = data || [];
                renderInspirations();
                setInspirationSyncStatus('', 'Synced');
            } catch (error) {
                console.error('Error loading inspirations:', error);
                setInspirationSyncStatus('error', 'Failed to load');
            } finally {
                loadingState.style.display = 'none';
            }
        }

        function renderInspirations() {
            const grid = document.getElementById('inspirationGrid');
            const emptyState = document.getElementById('inspirationEmptyState');

            if (inspirations.length === 0) {
                grid.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            grid.style.display = 'grid';
            emptyState.style.display = 'none';

            grid.innerHTML = inspirations.map(insp => `
                <div class="design-item" onclick="openInspirationPreview('${insp.id}')">
                    <div class="design-item-image">
                        <img src="${insp.file_url}" alt="${insp.file_name}" loading="lazy">
                    </div>
                    <div class="design-item-info">
                        <div class="design-item-name">${insp.description || insp.file_name}</div>
                        <div class="design-item-tags">
                            <span class="tag tag-category">${insp.category || 'Uncategorized'}</span>
                            <span class="tag tag-designer">${insp.designer || 'Unknown'}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        async function handleInspirationUpload(event) {
            const files = event.target.files;
            if (!files.length) return;

            const description = document.getElementById('inspirationDescription').value.trim();
            if (!description) {
                alert('Please enter a description for the inspiration image');
                return;
            }

            const category = document.getElementById('inspirationCategory').value;
            const designer = document.getElementById('inspirationDesigner').value;

            const uploadZone = document.getElementById('inspirationUploadZone');
            const uploadText = document.getElementById('inspirationUploadText');

            uploadZone.classList.add('uploading');
            uploadText.textContent = 'Uploading...';
            setInspirationSyncStatus('syncing', 'Uploading...');

            try {
                for (const file of files) {
                    if (!file.type.startsWith('image/')) continue;

                    // Create unique filename
                    const timestamp = Date.now();
                    const safeName = file.name.replace(/[^a-zA-Z0-9.-]/g, '_');
                    const filePath = `inspirations/${category}/${timestamp}_${safeName}`;

                    // Upload to storage
                    const { error: uploadError } = await supabaseClient.storage
                        .from(BUCKET_NAME)
                        .upload(filePath, file, {
                            cacheControl: '3600',
                            upsert: false
                        });

                    if (uploadError) throw uploadError;

                    // Get public URL
                    const fileUrl = `${SUPABASE_URL}/storage/v1/object/public/${BUCKET_NAME}/${filePath}`;

                    // Insert into database
                    const { error: dbError } = await supabaseClient
                        .from('inspirations')
                        .insert({
                            file_name: file.name,
                            file_url: fileUrl,
                            description: description,
                            category: category,
                            designer: designer
                        });

                    if (dbError) throw dbError;
                }

                await loadInspirations();
                setInspirationSyncStatus('', 'Synced');
                document.getElementById('inspirationDescription').value = '';

            } catch (error) {
                console.error('Error uploading:', error);
                setInspirationSyncStatus('error', 'Upload failed');
                alert('Upload failed: ' + error.message);
            } finally {
                uploadZone.classList.remove('uploading');
                uploadText.textContent = 'Drop inspiration images here or click to upload';
                event.target.value = '';
            }
        }

        function openInspirationPreview(id) {
            currentInspiration = inspirations.find(i => i.id === id);
            if (currentInspiration) {
                document.getElementById('inspirationModalTitle').textContent = currentInspiration.file_name;
                document.getElementById('inspirationModalImage').src = currentInspiration.file_url;

                document.getElementById('inspirationModalInfo').innerHTML = `
                    <div class="modal-info-row">
                        <span class="modal-info-label">Description</span>
                        <span class="modal-info-value">${currentInspiration.description}</span>
                    </div>
                    <div class="modal-info-row">
                        <span class="modal-info-label">Category</span>
                        <span class="modal-info-value">${currentInspiration.category || 'Uncategorized'}</span>
                    </div>
                    <div class="modal-info-row">
                        <span class="modal-info-label">Designer</span>
                        <span class="modal-info-value">${currentInspiration.designer || 'Unknown'}</span>
                    </div>
                `;

                document.getElementById('inspirationModal').classList.add('active');
            }
        }

        function closeInspirationModal() {
            document.getElementById('inspirationModal').classList.remove('active');
            currentInspiration = null;
        }

        function useInspiration() {
            if (currentInspiration) {
                // Set the description in the generator
                document.getElementById('imageB').value = currentInspiration.description;

                // Set the image preview
                document.getElementById('imageBPlaceholder').style.display = 'none';
                document.getElementById('imageBSelected').src = currentInspiration.file_url;
                document.getElementById('imageBSelected').style.display = 'block';

                // Regenerate the prompt
                generatePrompt();

                closeInspirationModal();
                switchTab('generator');
            }
        }

        async function deleteInspiration() {
            if (!currentInspiration) return;

            if (!confirm('Are you sure you want to delete this inspiration?')) return;

            const deleteBtn = document.getElementById('deleteInspirationBtn');
            deleteBtn.disabled = true;
            deleteBtn.textContent = 'Deleting...';

            try {
                // Extract file path from URL
                const urlParts = currentInspiration.file_url.split(`${BUCKET_NAME}/`);
                const filePath = urlParts[1];

                // Delete from storage
                const { error: storageError } = await supabaseClient.storage
                    .from(BUCKET_NAME)
                    .remove([filePath]);

                if (storageError) console.warn('Storage delete error:', storageError);

                // Delete from database
                const { error: dbError } = await supabaseClient
                    .from('inspirations')
                    .delete()
                    .eq('id', currentInspiration.id);

                if (dbError) throw dbError;

                closeInspirationModal();
                await loadInspirations();
            } catch (error) {
                console.error('Error deleting:', error);
                alert('Delete failed: ' + error.message);
            } finally {
                deleteBtn.disabled = false;
                deleteBtn.textContent = 'Delete';
            }
        }

        // Drag and drop for inspirations
        const inspirationUploadZone = document.getElementById('inspirationUploadZone');

        inspirationUploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            inspirationUploadZone.classList.add('dragover');
        });

        inspirationUploadZone.addEventListener('dragleave', () => {
            inspirationUploadZone.classList.remove('dragover');
        });

        inspirationUploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            inspirationUploadZone.classList.remove('dragover');
            const files = e.dataTransfer.files;
            handleInspirationUpload({ target: { files } });
        });

        // Paste support for inspirations (works anywhere when on inspiration tab)
        document.addEventListener('paste', async (e) => {
            // Only handle paste when on inspiration tab
            const inspirationTab = document.getElementById('inspiration-tab');
            if (!inspirationTab.classList.contains('active')) return;

            // Don't intercept if user is typing in a text input (except our description field)
            const activeEl = document.activeElement;
            if (activeEl.tagName === 'INPUT' && activeEl.id !== 'inspirationDescription') return;
            if (activeEl.tagName === 'TEXTAREA') return;

            const items = e.clipboardData?.items;
            if (!items) return;

            const imageFiles = [];
            for (const item of items) {
                if (item.type.startsWith('image/')) {
                    const file = item.getAsFile();
                    if (file) {
                        // Create a new file with a generated name
                        const timestamp = Date.now();
                        const extension = file.type.split('/')[1] || 'png';
                        const newFile = new File([file], `pasted_image_${timestamp}.${extension}`, { type: file.type });
                        imageFiles.push(newFile);
                    }
                }
            }

            if (imageFiles.length > 0) {
                e.preventDefault();

                // Check if description is filled
                const description = document.getElementById('inspirationDescription').value.trim();
                if (!description) {
                    // Flash the description field to show it needs to be filled
                    const descInput = document.getElementById('inspirationDescription');
                    descInput.style.borderColor = '#ef4444';
                    descInput.style.boxShadow = '0 0 0 3px rgba(239, 68, 68, 0.2)';
                    descInput.focus();
                    descInput.placeholder = '‚ö†Ô∏è Please enter a description first, then paste again';
                    setTimeout(() => {
                        descInput.style.borderColor = '';
                        descInput.style.boxShadow = '';
                        descInput.placeholder = 'e.g., watercolour floral pattern, geometric abstract art, cute animal illustration';
                    }, 3000);
                    return;
                }

                // Flash the upload zone to show paste was detected
                const uploadText = document.getElementById('inspirationUploadText');
                inspirationUploadZone.classList.add('dragover');
                uploadText.textContent = 'üìã Image pasted! Uploading...';

                handleInspirationUpload({ target: { files: imageFiles } });
            }
        });

        // Close inspiration modal on overlay click
        document.getElementById('inspirationModal').addEventListener('click', (e) => {
            if (e.target.id === 'inspirationModal') {
                closeInspirationModal();
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            generatePrompt();
            loadInspirations(); // Load inspirations since it's the default tab
        });

        document.getElementById('imageB').addEventListener('input', generatePrompt);
    </script>
</body>
</html>
